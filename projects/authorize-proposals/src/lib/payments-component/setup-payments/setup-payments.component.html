<div>
  <br />

  <mat-card-title>Setup Payment Templates</mat-card-title>
  <button
    mat-raised-button
    color="primary"
    style="float: right; margin-right: 20px; margin-bottom: 20px"
    type="button"
    (click)="openModal()"
  >
    Batch Upload
  </button>
  <div class="table-container">
    <br />

    <form [formGroup]="searchForm" class="padded-form">
      <div class="form-flex">
        <mat-form-field class="flex-item" appearance="fill">
          <mat-label>Payment Number</mat-label>
          <input formControlName="policyNumber" matInput type="text" />
        </mat-form-field>

        <mat-form-field class="flex-item" appearance="fill">
          <mat-label>Proposal Number</mat-label>
          <input formControlName="proposalNumber" matInput type="text" />
        </mat-form-field>
      </div>

      <div class="form-flex">
        <mat-form-field class="flex-item" appearance="fill">
          <mat-label>Client Name</mat-label>
          <input formControlName="clientName" matInput type="text" />
        </mat-form-field>

        <mat-form-field class="flex-item" appearance="fill">
          <mat-label>Phone Number</mat-label>
          <input formControlName="phoneNumber" matInput type="number" />
        </mat-form-field>
      </div>
    </form>

    <button
      mat-raised-button
      color="primary"
      style="float: right; margin-right: 20px; margin-bottom: 20px"
      type="button"
      (click)="search(searchResultsModal)"
    >
      Search
    </button>
  </div>

  <!-- Modal to Display Search Results -->
  <ng-template #searchResultsModal let-modal>
    <div class="modal-content custom-modal">
      <div class="modal-header custom-header">
        <h5 class="modal-title">Policies</h5>
      </div>

      <div class="modal-body custom-body">
        <table class="table table-bordered">
          <thead class="custom-table-header">
            <tr>
              <th>Proposal Number</th>
              <th>Policy Number</th>
              <th>Client</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of searchResults">
              <td>{{ item.proposalNumber }}</td>
              <td>{{ item.policyNumber }}</td>
              <td>{{ item.clientName }}</td>
              <td>
                <!-- View Details Button -->
                <button mat-button color="primary" (click)="viewDetails(item)">
                  View Details
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer custom-footer">
        <button type="button" class="btn btn-secondary" (click)="modal.close()">
          Close
        </button>
      </div>
    </div>
  </ng-template>
</div>

<ng-template #searchResultsModal let-modal>
  <div class="modal-content custom-modal">
    <div class="modal-header custom-header">
      <h5 class="modal-title">Policies</h5>
    </div>

    <div class="modal-body custom-body">
      <table class="table table-bordered">
        <thead class="custom-table-header">
          <tr>
            <th>Proposal Number</th>
            <th>Policy Number</th>
            <th>Client</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of searchResults">
            <td>{{ item.proposalNumber }}</td>
            <td>{{ item.policyNumber }}</td>
            <td>{{ item.client }}</td>
            <td>
              <!-- View Details Button -->
              <button mat-button color="primary" (click)="viewDetails(item)">
                View Details
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer custom-footer">
      <button type="button" class="btn btn-secondary" (click)="modal.close()">
        Close
      </button>
    </div>
  </div>
</ng-template>

<ng-template #batchUploadModal let-modal>
  <div class="modal-content shadow-lg rounded-3">
    <!-- Modal Header -->
    <div
      class="modal-header text-white d-flex justify-content-center"
      style="background-color: #900000; height: 80px"
    >
      <h5 class="modal-title w-100 text-center fs-4 fw-bold">Batch Upload</h5>
    </div>

    <!-- Modal Body -->
    <div class="modal-body px-6 py-4">
      <!-- Download CSV Section -->
      <div class="mb-4">
        <h6 class="fw-bold">Download Sample CSV</h6>
        <p>Download a sample CSV file to understand the required format.</p>
        <button class="btn btn-primary" (click)="downloadSampleCSV()">
          Download Sample CSV
        </button>
      </div>

      <!-- Upload CSV Section -->
      <div>
        <h6 class="fw-bold">Upload CSV File</h6>
        <p>Upload a CSV file to process the data.</p>
        <input
          type="file"
          class="form-control"
          accept=".csv"
          (change)="onFileUpload($event)"
        />
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer d-flex justify-content-center p-3">
      <button
        type="button"
        class="btn btn-outline-dark rounded-2 px-4"
        (click)="modal.dismiss()"
      >
        Close
      </button>
    </div>
  </div>
</ng-template>
