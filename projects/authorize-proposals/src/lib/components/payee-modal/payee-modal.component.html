<div class="modal-content shadow-lg rounded-3">
  <!-- Modal Header -->
  <div class="modal-header text-white d-flex justify-content-center" 
       style="background-color: #900000; height: 80px">
    <h5 class="modal-title w-100 text-center fs-4 fw-bold">Requisition</h5>
  </div>

  <!-- Modal Body -->
  <div class="modal-body px-4 py-4">
    <form [formGroup]="payeeForm" class="payee-form">
      
      <!-- DEBUG: Simple test dropdown -->
      <div class="row mb-3">
        <div class="col-md-12">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Test Dropdown</mat-label>
            <mat-select>
              <mat-option value="test1">Test Option 1</mat-option>
              <mat-option value="test2">Test Option 2</mat-option>
              <mat-option value="test3">Test Option 3</mat-option>
            </mat-select>
            <mat-hint>This is a test dropdown to verify Angular Material works</mat-hint>
          </mat-form-field>
        </div>
      </div>

      <!-- Row 1: Code and Input Cheque Payee -->
      <div class="row mb-3">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Code *</mat-label>
            <input matInput formControlName="code" placeholder="Enter code">
            <mat-error *ngIf="hasError('code')">
              {{ getErrorMessage('code') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Input Cheque Payee *</mat-label>
            <input matInput formControlName="inputChequePayee" placeholder="Enter cheque payee">
            <mat-error *ngIf="hasError('inputChequePayee')">
              {{ getErrorMessage('inputChequePayee') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Row 2: Payee and Payee Bank Branch -->
      <div class="row mb-3">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Payee *</mat-label>
            <input matInput formControlName="payee" placeholder="Enter payee name"
                   (blur)="onPayeeChange(); onPayeeNameChange()">
            <mat-error *ngIf="hasError('payee')">
              {{ getErrorMessage('payee') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Payee Bank Branch *</mat-label>
            <mat-select formControlName="payeeBankBranch">
              <mat-option value="">-- Select Bank Branch --</mat-option>
              <mat-option *ngFor="let branch of bankBranches; trackBy: trackByValue" [value]="branch.value">
                {{ branch.name }}
              </mat-option>
            </mat-select>
            <mat-hint>{{ bankBranches?.length || 0 }} branches available</mat-hint>
            <mat-error *ngIf="hasError('payeeBankBranch')">
              {{ getErrorMessage('payeeBankBranch') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Row 3: Payee Account No and Narrative -->
      <div class="row mb-3">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Payee Account No *</mat-label>
            <input matInput formControlName="payeeAccountNo" placeholder="Enter 10-digit account number">
            <mat-error *ngIf="hasError('payeeAccountNo')">
              {{ getErrorMessage('payeeAccountNo') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Narrative *</mat-label>
            <textarea matInput formControlName="narrative" rows="3" 
                      placeholder="Enter narrative (max 500 characters)"></textarea>
            <mat-error *ngIf="hasError('narrative')">
              {{ getErrorMessage('narrative') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Row 4: Invoice No and Invoice Date -->
      <div class="row mb-3">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Invoice No *</mat-label>
            <input matInput formControlName="invoiceNo" placeholder="Enter invoice number">
            <mat-error *ngIf="hasError('invoiceNo')">
              {{ getErrorMessage('invoiceNo') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Invoice Date *</mat-label>
            <input matInput [matDatepicker]="invoicePicker" formControlName="invoiceDate"
                   readonly placeholder="Select invoice date"
                   [max]="getTodayDate()">
            <mat-datepicker-toggle matSuffix [for]="invoicePicker"></mat-datepicker-toggle>
            <mat-datepicker #invoicePicker [startAt]="getTodayDate()"></mat-datepicker>
            <mat-hint>Select the invoice date (cannot be future date)</mat-hint>
            <mat-error *ngIf="hasError('invoiceDate')">
              {{ getErrorMessage('invoiceDate') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Row 5: Amount and Currency -->
      <div class="row mb-3">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Amount *</mat-label>
            <input matInput type="number" formControlName="amount" placeholder="0.00" min="0" step="0.01">
            <mat-error *ngIf="hasError('amount')">
              {{ getErrorMessage('amount') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Currency *</mat-label>
            <mat-select formControlName="currency">
              <mat-option *ngFor="let currency of currencies" [value]="currency.value">
                {{ currency.symbol }} - {{ currency.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Default: Nigerian Naira (â‚¦) | Available: {{ currencies?.length || 0 }}</mat-hint>
            <mat-error *ngIf="hasError('currency')">
              {{ getErrorMessage('currency') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Row 6: Bank Account and Type -->
      <div class="row mb-3">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Bank Account *</mat-label>
            <mat-select formControlName="bankAccount">
              <mat-option value="">-- Select Bank Account --</mat-option>
              <mat-option *ngFor="let account of bankAccounts" [value]="account.value">
                {{ account.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Choose the account to debit | Available: {{ bankAccounts?.length || 0 }}</mat-hint>
            <mat-error *ngIf="hasError('bankAccount')">
              {{ getErrorMessage('bankAccount') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Type *</mat-label>
            <mat-select formControlName="type">
              <mat-option value="">-- Select Payee Type --</mat-option>
              <mat-option *ngFor="let type of payeeTypes" [value]="type.value">
                {{ type.name }}
              </mat-option>
            </mat-select>
            <mat-hint>Select the category of payee | Available: {{ payeeTypes?.length || 0 }}</mat-hint>
            <mat-error *ngIf="hasError('type')">
              {{ getErrorMessage('type') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Row 7: Payment Option -->
      <div class="row mb-3">
        <div class="col-md-12">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Payment Option *</mat-label>
            <mat-select formControlName="paymentOption">
              <mat-option value="">-- Select Payment Method --</mat-option>
              <mat-optgroup label="Electronic Transfers">
                <mat-option *ngFor="let option of paymentOptions.slice(0, 3)" [value]="option.value">
                  {{ option.name }}
                </mat-option>
              </mat-optgroup>
              <mat-optgroup label="Traditional Methods">
                <mat-option *ngFor="let option of paymentOptions.slice(3, 7)" [value]="option.value">
                  {{ option.name }}
                </mat-option>
              </mat-optgroup>
              <mat-optgroup label="Digital & Mobile">
                <mat-option *ngFor="let option of paymentOptions.slice(7)" [value]="option.value">
                  {{ option.name }}
                </mat-option>
              </mat-optgroup>
            </mat-select>
            <mat-hint>Choose the preferred payment method | Available: {{ paymentOptions?.length || 0 }}</mat-hint>
            <mat-error *ngIf="hasError('paymentOption')">
              {{ getErrorMessage('paymentOption') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

    </form>
  </div>

  <!-- Debug Information -->
  <div class="modal-body px-4 py-2 bg-light">
    <small class="text-muted">
      <strong>Debug Info:</strong>
      Branches: {{ bankBranches?.length || 0 }} |
      Accounts: {{ bankAccounts?.length || 0 }} |
      Types: {{ payeeTypes?.length || 0 }} |
      Payments: {{ paymentOptions?.length || 0 }} |
      Currencies: {{ currencies?.length || 0 }}
    </small>
  </div>

  <!-- Modal Footer -->
  <div class="modal-footer d-flex justify-content-between align-items-center px-4 py-3">
    <button type="button" class="btn btn-info btn-sm" (click)="checkDropdownData()">
      Debug Data
    </button>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancel
      </button>
      <button type="button" class="btn btn-primary" (click)="onSave()"
              [disabled]="payeeForm.invalid">
        Save
      </button>
    </div>
  </div>
</div>
